---
title: "A global database on animal biodiversity measured in different grazing treatments"
author: "Alessandro Filazzola & Tianna Barber-Cross"
date: "6/19/2020"
output:
  html_document:
    theme: flatly
    toc: yes
    toc_depth: 3
    toc_float: yes
  pdf_document:
    toc: yes
editor_options: 
  chunk_output_type: console
---
<br>  


![](./grazing.jpg)


### Load Libraries and Data
```{r warning=FALSE, message=FALSE}
## Load libraries
library(tidyverse)
library(ggthemes)

## Load functions
source("scripts//figureFormat.r")

## Load data on study information
studyData <- read.csv("data//StudyData.csv")

## load all data on grazing and merge with simplified datasets
data <- read.csv("data//grazingData.csv")
est <- read.csv("data//simpleCategories//estimateCategories.csv")
graze <- read.csv("data//simpleCategories//grazingCategories.csv")
data <- merge(data, est, by="Estimate")
data <- merge(data, graze, by="grazing.estimate")

```

### A distribution of where the studies took place
```{r}

require(ggmap)
require(maps)
###  Start with base map of world
mp <- NULL
mapWorld <- borders("world", colour="gray50", fill="gray75") # create a layer of borders
mp <- ggplot() + theme_bw()+  mapWorld

mp <- mp+ geom_point(data=studyData , aes(x=lon, y=lat, color=grazer.status), size=2) + scale_color_manual(values=c("#D55E00", "#E69F00", "#56B4E9")) + ylab("Latitude") + xlab("Longitude")
mp

```


### Visualize patterns among studies
```{r}
## Replicates
names(studyData)
ggplot(studyData, aes(x = as.numeric(n.sites))) + geom_histogram(fill="Grey50") + theme_Publication() + xlab("Number of sites") + ylab("Frequency of studies") + scale_x_continuous(trans =  "log2")

ggplot(studyData, aes(x = as.numeric(study.duration))) + geom_histogram(fill="Grey50") + theme_Publication() + xlab("Duration of study in years") + ylab("Frequency of studies")+ scale_x_continuous(trans =  "log2")
```

### Pattern among Vegetation Classes
```{r}
## Split by semi-colon
unnestVeg <- studyData %>%   unnest(veg.class = strsplit(veg.class, ";"))
## Summarize by each class
VegClass <- unnestVeg %>% group_by(veg.class) %>% summarize(n=length(veg.class)) %>% filter(!is.na(veg.class))

ggplot(VegClass, aes(x=veg.class, y=n)) + geom_bar(stat="identity") + theme_Publication() + xlab("") + ylab("Number of studies") + coord_flip()

```

### Most common grazers
```{r}
## Split by semi-colon
unnestGraze <- studyData %>%   unnest(herbivores = strsplit(herbivores, ";"))
## Summarize by each class
herbsum <- unnestGraze %>% group_by(herbivores) %>% summarize(n=length(herbivores)) %>% filter(!is.na(herbivores)) 

topherb <- herbsum %>% top_n(20) ## select 10 most commonly surveyed


ggplot(topherb, aes(x=reorder(herbivores, -n), y=n)) + geom_bar(stat="identity") + theme_Publication() + xlab("") + ylab("Number of studies") + coord_flip()

```

### Summary statistics of other categories
```{r}
studyData %>% group_by(openvsfenced) %>% summarize(n=length(uniqueID))
studyData %>% group_by(tilledvsleftalone) %>% summarize(n=length(uniqueID))
studyData %>% group_by(fire) %>% summarize(n=length(uniqueID))
studyData %>% group_by(fertilization) %>% summarize(n=length(uniqueID))

```